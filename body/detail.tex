\chapter{部分实现细节}

\section{评测结果的真实性}

如果用户通过某种途径（如HTTPS抓包）获取了服务端的评测接口，想通过直接调用接口的形式仿造题目评测，这是有可能的。我们在服务端对这种情况进行了处理，即用户在评测题目后会将用户的程序上传到服务端，服务端可以再次对这些代码进行评测，验证这些程序的合法性与真实性。对于组织创建的比赛，我们提供了对用户上传的程序进行查重与重测的接口，保证比赛系统的公正性。

如果人力等资源允许，事实上还可以通过训练机器学习模型，来进一步判定用户代码是否是根据题目输出编程得来的，或者是伪造的。考虑到根据题目输出编程得来的程序的特征（源代码中包含大量标准输出），使用正则表达式匹配就能筛选出大部分这类程序。这一部分的工作我们仍处于筹划阶段，具体实现方法仍待考虑。

\section{教程的渲染}

PhoeniX给用户呈现的教程需要能够嵌入代码执行环境，渲染Latex公式以及Markdown语法，保证渲染后的教程对用户而言没有安全风险。经过考量之后，我们选用了以markdown-it渲染器为核心的渲染方案，原因有如下几点：

\begin{enumerate}
    \item 教程的渲染需要较高的效率，而且之后可能需要支持更多的语法与渲染内容，引入第三方封装的markdown编辑器做渲染是明显不合适的，这些编辑器的渲染效率不高，且难以自定义渲染效果。
    \item markdown-it渲染器本身足够轻量，使用者和维护者都较多，能够识别并正确渲染HTML保证用户安全，且支持自定义插件，容易自定义渲染效果。
    \item markdown-it有一些现成的足够轻量的插件，分别能够支持Latex渲染、Markdown扩展语法渲染等任务，不需要重新手写太多插件。
\end{enumerate}

然而，markdown-it渲染器只能完成最基本的渲染任务，对于内嵌的代码执行环境，我们是使用Monaco编辑器和Xterm虚拟终端实现的。Monaco编辑器和Xterm终端是微软的开源项目Visual Studio Code（以下简称VSCode）解决方案的一部分，考虑到VSCode给用户提供的绝佳体验，我们认为VSCode的编辑器解决方案是成功的。在PhoeniX的具体实现上，我们对Monaco和Xterm都进行了一定程度的自定义，使其能够较为美观的呈现，并保有执行我们提供的命令的基本功能。

\section{推荐算法的设计}

我们设计了一套基于情景感知的题目推荐模型。我们的设计理念是要尽可能地推荐用户最有可能查看并完成的题目。即，规定事件 $X$ 为用户对于某个题目的提交。$Y$ 表示用户当前的“情景”。其构成包括：用户近期所做过的题目、题目标签、题目难度、用户所属的组织、组织成员的做题偏好等。我们的目标则是最大化 $P(X|Y)$。

具体而言，我们针对特定情境寻找题目时，会计算下列信息：

\begin{enumerate}
    \item 提取出用户近期提交过的题目标签。提升拥有相同标签的题目的权重。
    \item 根据用户最近过题的难易程度，降低难度较高或较低的题目权重。
    \item 查看用户所属组织成员的做题情况，提升组织内其他成员做过的题目的权重。
    \item 系统内预设一套学习路线，根据学习路线预测用户接下来可能学习的知识点。提升其模板题的权重。
\end{enumerate}

我们将题目按照权重排序，选择权重最高的题目返回给用户，实现个性化的推荐功能。此外，我们还会全局统计每个题的近期过题量，找出近期的热门题目，以排行榜的形式展示。这也可以作为用户选择题目的参考。

在具体的实现中，由于不同影响因素的重要程度难以衡量，我们会尽可能的给用户更多样化的选择，具体而言。当有很多权重很高的题目时，我们会随机删除掉部分权重很高但是题目标签重复出现的题目。来保证我们推荐的题目的多样性。